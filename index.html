<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Training Audit Checklist</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { background: #f3f4f6; font-family: sans-serif; margin: 0; }
    .container { max-width: 800px; margin: 2rem auto; background: #fff; padding: 1rem; border-radius: .5rem; }
    .title { text-align: center; font-size: 1.75rem; font-weight: 700; margin-bottom: 1rem; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 1rem; }
    th, td { border: 1px solid #e5e7eb; padding: .5rem; }
    th { background-color: #e5e7eb; }
    input[type=radio] { margin-right: .25rem; }
    .photo-preview { max-width: 100px; margin-right: .5rem; margin-bottom: .5rem; border-radius: .25rem; }
    .submit-btn { background: #4f46e5; color: #fff; padding: .75rem 1.5rem; border: none; border-radius: .375rem; cursor: pointer; }
  </style>
</head>
<body>
  <div class="container" id="root"></div>
  <script>
    const { useState, useEffect } = React;
    const CHECKLIST = { sections: [
      { id: 'Training Materials', title: 'Training Materials', items: [
        { id: 'TM_1', q: 'FRM available at store?', w: 1 },
        { id: 'TM_2', q: 'BRM available at store?', w: 1 },
        { id: 'TM_3', q: 'One-pager – Hot/Cue Cards displayed?', w: 1 },
        { id: 'TM_4', q: 'One-pager – Cold/Cue Cards displayed?', w: 1 },
        { id: 'TM_5', q: 'Dial-in One-pager visible?', w: 2 },
        { id: 'TM_6', q: 'New-launch learning material posted?', w: 1 },
        { id: 'TM_7', q: 'COFFEE Playbook in store?', w: 1 },
        { id: 'TM_8', q: 'Shelf-life chart displayed?', w: 1 },
        { id: 'TM_9', q: 'Career progression chart displayed?', w: 1 }
      ]},
      { id: 'LMS', title: 'LMS Usage', items: [
        { id: 'LMS_1', q: 'Orientation & Induction completed within 3 days?', w: 4 },
        { id: 'LMS_2', q: 'All assessments & knowledge checks on LMS?', w: 4 },
        { id: 'LMS_3', q: 'Team uses LMS for new info & comms?', w: 2 }
      ]},
      { id: 'Buddy', title: 'Buddy Trainer Capabilities', items: [
        { id: 'Buddy_1', q: '≥2 certified Buddy Trainers in café?', w: 2 },
        { id: 'Buddy_2', q: 'Buddy Trainers passed skill checks?', w: 2 },
        { id: 'Buddy_3', q: 'Trainees rostered with Buddies?', w: 2 },
        { id: 'Buddy_4', q: 'Logbook up-to-date?', w: 1 },
        { id: 'Buddy_5', q: 'Badge worn during training?', w: 1 },
        { id: 'Buddy_6', q: 'Schedules visible?', w: 1 },
        { id: 'Buddy_7', q: 'Monthly feedback sessions?', w: 1 }
      ]},
      { id: 'NewJoiner', title: 'New Joiner Training', items: [
        { id: 'NJ_1', q: 'Tracker updated?', w: 2 },
        { id: 'NJ_2', q: '15-day cert completed?', w: 2 },
        { id: 'NJ_3', q: 'Skill gaps documented?', w: 1 },
        { id: 'NJ_4', q: 'Training wall current?', w: 1 },
        { id: 'NJ_5', q: 'Learning plan filed?', w: 1 },
        { id: 'NJ_6', q: 'Cert cards issued?', w: 1 },
        { id: 'NJ_7', q: 'Refresher logged?', w: 1 }
      ]},
      { id: 'Partner', title: 'Partner Knowledge', items: [
        { id: 'PK_1', q: 'Team knows company comms?', w: 1 },
        { id: 'PK_2', q: 'Tasting & sampling done?', w: 1 },
        { id: 'PK_3', q: 'Sampling follows guidelines?', w: 1 },
        { id: 'PK_4', q: 'Tasting engaging?', w: 1 },
        { id: 'PK_5', q: 'Team knows manual brew?', w: 1 },
        { id: 'PK_6', q: 'Grooming standards met?', w: 1 },
        { id: 'PK_7', q: 'Pop-quiz passed?', w: 1 }
      ]},
      { id: 'TSA', title: 'Skill Assessment', items: [
        { id: 'TSA_1', q: 'Hot & Cold stations working?', w: 1 },
        { id: 'TSA_2', q: 'Food station cleanliness?', w: 1 },
        { id: 'TSA_3', q: 'Customer Service quality?', w: 1 }
      ]},
      { id: 'CX', title: 'Customer Experience', items: [
        { id: 'CX_1', q: 'Music at right volume?', w: 1 },
        { id: 'CX_2', q: 'Temperature comfortable?', w: 1 },
        { id: 'CX_3', q: 'Washrooms clean?', w: 1 },
        { id: 'CX_4', q: 'Wi-Fi working?', w: 1 },
        { id: 'CX_5', q: 'VM elements correct?', w: 1 },
        { id: 'CX_6', q: 'Furniture well-kept?', w: 1 },
        { id: 'CX_7', q: 'Staff know key metrics?', w: 1 },
        { id: 'CX_8', q: 'Mystery Audit score known?', w: 1 },
        { id: 'CX_9', q: 'Top 2 CX opps named?', w: 1 }
      ]},
      { id: 'AP', title: 'Action Plan', items: [
        { id: 'AP_1', q: 'Concerns addressed?', w: 2 },
        { id: 'AP_2', q: 'Managers aware?', w: 3 }
      ]}
    ]};

    function freshResp() {
      const o = {};
      CHECKLIST.sections.forEach(s => s.items.forEach(i => o[i.id] = { score: null, na: false }));
      return o;
    }

    function App() {
      console.log('Checklist Questions:', CHECKLIST.sections.map(s => ({ section: s.title, questions: s.items.map(i => i.q) })));
      const params = new URLSearchParams(window.location.search);
      const auditor = { name: params.get('name')||'', id: params.get('id')||'' };
      const KEY = `audit_${auditor.id}`;
      const [resp, setResp] = useState(() => {
        try { return JSON.parse(localStorage.getItem(KEY))||freshResp(); } catch { return freshResp(); }
      });
      const [storeName, setStoreName] = useState('');
      const [storeId, setStoreId] = useState('');
      const [imgs, setImgs] = useState({});

      useEffect(() => localStorage.setItem(KEY, JSON.stringify(resp)), [resp]);
      const upd = (id, p) => setResp(r => ({ ...r, [id]: { ...r[id], ...p } }));
      const pick = (sid, e) => Array.from(e.target.files).forEach(f => {
        const r = new FileReader();
        r.onload = () => setImgs(i => ({ ...i, [sid]: [...(i[sid]||[]), r.result] }));
        r.readAsDataURL(f);
      });

      const submit = e => {
        e.preventDefault();
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        let t=0, m=0;
        CHECKLIST.sections.forEach(s => s.items.forEach(i => {
          const v=resp[i.id]||{};
          if(!v.na&&v.score!=null){t+=v.score; m+=i.w;}
        }));
        const score = `${t}/${m} (${m?Math.round(100*t/m):0}%)`;
        doc.text(`Score: ${score}`, 14, 14);
        doc.text(`Report | ${storeName}`, 14, 22);
        let y = 30;
        CHECKLIST.sections.forEach(s => {
          doc.setFontSize(12);
          doc.text(s.title, 14, y);
          y += 6;
          (imgs[s.id]||[]).forEach(img => {
            doc.addImage(img,'JPEG',14,y,50,30);
            y += 32;
          });
          const rows = s.items.map(i => {
            const v=resp[i.id]||{};
            return [i.q, v.na?'NA':(v.score===i.w?'Yes':'No')];
          });
          doc.autoTable({ startY: y, head:[['Question','Resp']], body: rows, styles:{fontSize:8} });
          y = doc.lastAutoTable.finalY + 10;
        });
        doc.save(`audit_${auditor.id}_${Date.now()}.pdf`);
      };

      return React.createElement('form',{onSubmit:submit},
        React.createElement('div',{className:'container'},
          React.createElement('h1',{className:'title'},'Third Wave Coffee | Training Audit'),
          React.createElement('div',{className:'grid grid-cols-2 md:grid-cols-4 gap-4 mb-6'},
            React.createElement('div',null,
              React.createElement('label',{className:'block mb-1 font-medium'},'Auditor Name'),
              React.createElement('input',{type:'text',value:auditor.name,readOnly:true,className:'w-full p-2 border rounded'})
            ),
            React.createElement('div',null,
              React.createElement('label',{className:'block mb-1 font-medium'},'Auditor ID'),
              React.createElement('input',{type:'text',value:auditor.id,readOnly:true,className:'w-full p-2 border rounded'})
            ),
            React.createElement('div',null,
              React.createElement('label',{className:'block mb-1 font-medium'},'Store Name'),
              React.createElement('input',{type:'text',value:storeName,onChange:e=>setStoreName(e.target.value),required:true,className:'w-full p-2 border rounded'})
            ),
            React.createElement('div',null,
              React.createElement('label',{className:'block mb-1 font-medium'},'Store ID'),
              React.createElement('input',{type:'text',value:storeId,onChange:e=>setStoreId(e.target.value),required:true,className:'w-full p-2 border rounded'})
            )
          ),
          CHECKLIST.sections.map(s => React.createElement('div',{key:s.id,className:'section mb-6'},
            React.createElement('h2',null,s.title),
            React.createElement('input',{type:'file',accept:'image/*',capture:'environment',multiple:true,onChange:e=>pick(s.id,e)}),
            React.createElement('div',null,(imgs[s.id]||[]).map((src,i)=>React.createElement('img',{key:i,src, className:'photo-preview'}))),
            React.createElement('table',null,
              React.createElement('thead',null,React.createElement('tr',null,React.createElement('th',null,'Question'),React.createElement('th',null,'Yes'),React.createElement('th',null,'No'),React.createElement('th',null,'NA'))),
              React.createElement('tbody',null,s.items.map(i=>React.createElement('tr',{key:i.id},
                React.createElement('td',null,i.q),
                React.createElement('td',{className:'text-center'},React.createElement('input',{type:'radio',name:i.id,value:'yes',required:true,checked:resp[i.id]?.score===i.w,onChange:() => upd(i.id,{score:i.w,na:false})})),
                React.createElement('td',{className:'text-center'},React.createElement('input',{type:'radio',name:i.id,value:'no',checked:resp[i.id]?.score===0&&!resp[i.id]?.na,onChange:() => upd(i.id,{score:0,na:false})})),
                React.createElement('td',{className:'text-center'},React.createElement('input',{type:'radio',name:i.id,value:'na',checked:resp[i.id]?.na,onChange:() => upd(i.id,{na:true,score:null})}))
              )))
            )
          )),
          React.createElement('button',{type:'submit',className:'submit-btn'},'Submit & Download PDF')
        )
      );
    }
    ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
  </script>
</body>
</html>
