<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Training Audit Checklist</title>
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React/ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    input[type="checkbox"]:focus { outline: 2px solid #6366f1; outline-offset: 1px; }
  </style>
  <!-- EMBEDDED CHECKLIST DATA -->
  <script>
    window.CHECKLIST = {
      "name":"Training Audit Checklist","version":"1.0",
      "sections":[
        {"id":"Training Materials","title":"Training Materials","items":[
          {"id":"TM_1","question":"FRM available at store?","weight":1,"allow_na":true},
          {"id":"TM_2","question":"BRM available at store?","weight":1,"allow_na":true},
          {"id":"TM_3","question":"One-pager – Hot/Cue Cards displayed?","weight":1,"allow_na":true},
          {"id":"TM_4","question":"One-pager – Cold/Cue Cards displayed?","weight":1,"allow_na":true},
          {"id":"TM_5","question":"Dial-in One-pager visible?","weight":2,"allow_na":true},
          {"id":"TM_6","question":"New-launch learning material posted?","weight":1,"allow_na":true},
          {"id":"TM_7","question":"COFFEE Playbook in store?","weight":1,"allow_na":true},
          {"id":"TM_8","question":"Shelf-life chart displayed?","weight":1,"allow_na":true},
          {"id":"TM_9","question":"Career progression chart displayed?","weight":1,"allow_na":true}
        ]},
        {"id":"LMS","title":"LMS Usage","items":[
          {"id":"LMS_1","question":"Orientation & Induction completed within 3 days?","weight":4,"allow_na":true},
          {"id":"LMS_2","question":"All assessments & knowledge checks on LMS?","weight":4,"allow_na":true},
          {"id":"LMS_3","question":"Team uses LMS for new info & comms?","weight":2,"allow_na":true}
        ]},
        {"id":"Buddy","title":"Buddy Trainer Capabilities","items":[
          {"id":"Buddy_1","question":"≥2 certified Buddy Trainers in café?","weight":2,"allow_na":true},
          {"id":"Buddy_2","question":"Buddy Trainers passed skill checks?","weight":2,"allow_na":true},
          {"id":"Buddy_3","question":"Trainees rostered with Buddies?","weight":2,"allow_na":true},
          {"id":"Buddy_4","question":"Logbook up-to-date?","weight":1,"allow_na":true},
          {"id":"Buddy_5","question":"Badge worn during training?","weight":1,"allow_na":true},
          {"id":"Buddy_6","question":"Schedules visible?","weight":1,"allow_na":true},
          {"id":"Buddy_7","question":"Monthly feedback sessions?","weight":1,"allow_na":true}
        ]},
        {"id":"NewJoiner","title":"New Joiner Training","items":[
          {"id":"NJ_1","question":"Tracker updated?","weight":2,"allow_na":true},
          {"id":"NJ_2","question":"15-day cert completed?","weight":2,"allow_na":true},
          {"id":"NJ_3","question":"Skill gaps documented?","weight":1,"allow_na":true},
          {"id":"NJ_4","question":"Training wall current?","weight":1,"allow_na":true},
          {"id":"NJ_5","question":"Learning plan filed?","weight":1,"allow_na":true},
          {"id":"NJ_6","question":"Cert cards issued?","weight":1,"allow_na":true},
          {"id":"NJ_7","question":"Refresher logged?","weight":1,"allow_na":true}
        ]},
        {"id":"Partner","title":"Partner Knowledge","items":[
          {"id":"PK_1","question":"Team knows company comms?","weight":1,"allow_na":true},
          {"id":"PK_2","question":"Tasting & sampling done?","weight":1,"allow_na":true},
          {"id":"PK_3","question":"Sampling follows guidelines?","weight":1,"allow_na":true},
          {"id":"PK_4","question":"Tasting engaging?","weight":1,"allow_na":true},
          {"id":"PK_5","question":"Team knows manual brew?","weight":1,"allow_na":true},
          {"id":"PK_6","question":"Grooming standards met?","weight":1,"allow_na":true},
          {"id":"PK_7","question":"Pop-quiz passed?","weight":1,"allow_na":true}
        ]},
        {"id":"TSA","title":"Skill Assessment","items":[
          {"id":"TSA_1","question":"Hot & Cold stations","weight":1,"allow_na":true},
          {"id":"TSA_2","question":"Food station","weight":1,"allow_na":true},
          {"id":"TSA_3","question":"Customer Service","weight":1,"allow_na":true}
        ]},
        {"id":"CX","title":"Customer Experience","items":[
          {"id":"CX_1","question":"Music at right volume?","weight":1,"allow_na":true},
          {"id":"CX_2","question":"Temperature comfortable?","weight":1,"allow_na":true},
          {"id":"CX_3","question":"Washrooms clean?","weight":1,"allow_na":true},
          {"id":"CX_4","question":"Wi-Fi working?","weight":1,"allow_na":true},
          {"id":"CX_5","question":"VM elements correct?","weight":1,"allow_na":true},
          {"id":"CX_6","question":"Furniture well-kept?","weight":1,"allow_na":true},
          {"id":"CX_7","question":"Staff know key metrics?","weight":1,"allow_na":true},
          {"id":"CX_8","question":"Mystery Audit score known?","weight":1,"allow_na":true},
          {"id":"CX_9","question":"Top 2 CX opps named?","weight":1,"allow_na":true}
        ]},
        {"id":"Action","title":"Action Plan","items":[
          {"id":"AP_1","question":"Concerns addressed?","weight":2,"allow_na":true},
          {"id":"AP_2","question":"Managers aware?","weight":3,"allow_na":true}
        ]}
      ]
    };
  </script>
</head>
<body class="bg-gray-100 min-h-screen p-6 flex justify-center">
  <div id="root" class="w-full max-w-4xl"></div>
  <script>
    const { useState, useEffect } = React;
    const checklist = window.CHECKLIST;
    const params = new URLSearchParams(location.search);
    const meta = {
      name: params.get('name')||'',
      id:   params.get('id')  ||'',
      time: new Date().toLocaleString()
    };
    const KEY = `audit_${meta.id}`;
    function fresh(){
      const obj = {};
      checklist.sections.forEach(s => s.items.forEach(i => {
        obj[i.id] = {score:0,na:false};
      }));
      return obj;
    }
    function App(){
      const [resp, setResp] = useState(() => {
        try { return JSON.parse(localStorage.getItem(KEY))||fresh() }
        catch { return fresh() }
      });
      useEffect(()=>{
        localStorage.setItem(KEY, JSON.stringify(resp));
      }, [resp]);
      const upd = (id, patch) =>
        setResp(r => ({...r, [id]: {...r[id], ...patch}}));
      const submit = () => {
        const jsPDF = window.jspdf.jsPDF;
        const doc  = new jsPDF();
        doc.setFontSize(14);
        doc.text("Training Audit Report", 105, 10, {align:"center"});
        doc.setFontSize(10);
        doc.text(`Name: ${meta.name}`, 10, 20);
        doc.text(`ID:   ${meta.id}`,   10, 26);
        doc.text(`Time: ${meta.time}`,  10, 32);
        let y = 40;
        checklist.sections.forEach(sec => {
          doc.setFontSize(12);
          doc.text(sec.title, 10, y); y += 6;
          doc.setFontSize(10);
          sec.items.forEach(it => {
            const r = resp[it.id];
            const st = r.na ? "NA" : (r.score===it.weight?"Yes":"No");
            const lines = doc.splitTextToSize(`- ${it.question} [${st}]`, 180);
            lines.forEach(l => {
              if (y > 280) { doc.addPage(); y = 20; }
              doc.text(l, 10, y); y += 5;
            });
          });
          y += 4;
          if (y > 280) { doc.addPage(); y = 20; }
        });
        doc.save(`audit_${meta.id}_${Date.now()}.pdf`);
        localStorage.removeItem(KEY);
      };
      return React.createElement("form",
        {onSubmit:e=>{e.preventDefault(); submit()}, className:"space-y-8"},
        React.createElement("header",{className:"text-center"},
          React.createElement("h1",{className:"text-3xl font-bold"},checklist.name),
          React.createElement("p",{className:"text-sm text-gray-500"},"v"+checklist.version),
          React.createElement("div",{className:"text-sm text-gray-600"},
            `Auditor: ${meta.name} (ID ${meta.id}) | Time: ${meta.time}`
          )
        ),
        ...checklist.sections.map(sec => React.createElement("section",
          {key:sec.id, className:"bg-white p-6 rounded-xl shadow"},
          React.createElement("h2",{className:"text-xl font-semibold mb-3"},sec.title),
          ...sec.items.map(it => {
            const r = resp[it.id];
            return React.createElement("div",{key:it.id, className:"mb-4"},
              React.createElement("label",{className:"block font-medium mb-1"},it.question),
              React.createElement("div",{className:"flex items-center gap-4"},
                React.createElement("label",{className:"inline-flex items-center gap-1"},
                  React.createElement("input",{type:"radio", name:it.id, checked:r.score===it.weight, onChange:()=>upd(it.id,{score:it.weight,na:false}), disabled:r.na}),"Yes"
                ),
                React.createElement("label",{className:"inline-flex items-center gap-1"},
                  React.createElement("input",{type:"radio", name:it.id, checked=r.score===0, onChange:()=>upd(it.id,{score:0,na:false}), disabled:r.na}),"No"
                ),
                React.createElement("label",{className:"inline-flex items-center gap-1"},
                  React.createElement("input",{type:"checkbox", checked=r.na, onChange:e=>upd(it.id,{na:e.target.checked,score:null})}),"NA"
                )
              )
            );
          })
        )),
        React.createElement("button",
          {type:"submit", className:"w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white py-3 px-6 rounded-xl font-bold"},
          "Submit Audit"
        )
      );
    }
    ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
  </script>
</body>
</html>
