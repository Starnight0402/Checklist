<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Training Audit Checklist</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React / React-DOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

  <!-- jsPDF + autoTable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body class="bg-gradient-to-br from-gray-100 via-white to-gray-100">

  <div id="root" class="max-w-lg mx-auto p-4"></div>

  <script>
    const { useState, useEffect } = React;

    const CHECKLIST = {
      sections: [
        { id:'Training Materials', title:'Training Materials', items:[
          { id:'TM_1', q:'FRM available at store?', w:1 },
          { id:'TM_2', q:'BRM available at store?', w:1 },
          { id:'TM_3', q:'One-pager – Hot/Cue Cards displayed?', w:1 },
          { id:'TM_4', q:'One-pager – Cold/Cue Cards displayed?', w:1 },
          { id:'TM_5', q:'Dial-in One-pager visible?', w:2 },
          { id:'TM_6', q:'New-launch learning material posted?', w:1 },
          { id:'TM_7', q:'COFFEE Playbook in store?', w:1 },
          { id:'TM_8', q:'Shelf-life chart displayed?', w:1 },
          { id:'TM_9', q:'Career progression chart displayed?', w:1 }
        ]},
        { id:'LMS', title:'LMS Usage', items:[
          { id:'LMS_1', q:'Orientation & Induction completed within 3 days?', w:4 },
          { id:'LMS_2', q:'All assessments & knowledge checks on LMS?', w:4 },
          { id:'LMS_3', q:'Team uses LMS for new info & comms?', w:2 }
        ]},
        { id:'Buddy', title:'Buddy Trainer Capabilities', items:[
          { id:'Buddy_1', q:'≥2 certified Buddy Trainers in café?', w:2 },
          { id:'Buddy_2', q:'Buddy Trainers passed skill checks?', w:2 },
          { id:'Buddy_3', q:'Trainees rostered with Buddies?', w:2 },
          { id:'Buddy_4', q:'Logbook up-to-date?', w:1 },
          { id:'Buddy_5', q:'Badge worn during training?', w:1 },
          { id:'Buddy_6', q:'Schedules visible?', w:1 },
          { id:'Buddy_7', q:'Monthly feedback sessions?', w:1 }
        ]},
        { id:'NewJoiner', title:'New Joiner Training', items:[
          { id:'NJ_1', q:'Tracker updated?', w:2 },
          { id:'NJ_2', q:'15-day cert completed?', w:2 },
          { id:'NJ_3', q:'Skill gaps documented?', w:1 },
          { id:'NJ_4', q:'Training wall current?', w:1 },
          { id:'NJ_5', q:'Learning plan filed?', w:1 },
          { id:'NJ_6', q:'Cert cards issued?', w:1 },
          { id:'NJ_7', q:'Refresher logged?', w:1 }
        ]},
        { id:'Partner', title:'Partner Knowledge', items:[
          { id:'PK_1', q:'Team knows company comms?', w:1 },
          { id:'PK_2', q:'Tasting & sampling done?', w:1 },
          { id:'PK_3', q:'Sampling follows guidelines?', w:1 },
          { id:'PK_4', q:'Tasting engaging?', w:1 },
          { id:'PK_5', q:'Team knows manual brew?', w:1 },
          { id:'PK_6', q:'Grooming standards met?', w:1 },
          { id:'PK_7', q:'Pop-quiz passed?', w:1 }
        ]},
        { id:'TSA', title:'Skill Assessment', items:[
          { id:'TSA_1', q:'Hot & Cold stations working?', w:1 },
          { id:'TSA_2', q:'Food station cleanliness?', w:1 },
          { id:'TSA_3', q:'Customer Service quality?', w:1 }
        ]},
        { id:'CX', title:'Customer Experience', items:[
          { id:'CX_1', q:'Music at right volume?', w:1 },
          { id:'CX_2', q:'Temperature comfortable?', w:1 },
          { id:'CX_3', q:'Washrooms clean?', w:1 },
          { id:'CX_4', q:'Wi-Fi working?', w:1 },
          { id:'CX_5', q:'VM elements correct?', w:1 },
          { id:'CX_6', q:'Furniture well-kept?', w:1 },
          { id:'CX_7', q:'Staff know key metrics?', w:1 },
          { id:'CX_8', q:'Mystery Audit score known?', w:1 },
          { id:'CX_9', q:'Top 2 CX opps named?', w:1 }
        ]},
        { id:'AP', title:'Action Plan', items:[
          { id:'AP_1', q:'Concerns addressed?', w:2 },
          { id:'AP_2', q:'Managers aware?', w:3 }
        ]}
      ]
    };

    function fresh() {
      const r = {};
      CHECKLIST.sections.forEach(s => s.items.forEach(i => r[i.id] = { score:null, na:false }));
      return r;
    }

    function App() {
      const p = new URLSearchParams(location.search);
      const auditor = { name: p.get('name')||'', id: p.get('id')||'' };
      const KEY = `audit_${auditor.id}`;
      const [resp, setResp] = useState(() => {
        try { return JSON.parse(localStorage.getItem(KEY)) || fresh(); }
        catch { return fresh(); }
      });
      const [storeName,setStoreName] = useState('');
      const [storeId,setStoreId]     = useState('');
      const [imgs,setImgs]           = useState({});

      useEffect(() => localStorage.setItem(KEY, JSON.stringify(resp)), [resp]);

      const upd = (id, patch) => setResp(r => ({ ...r, [id]: { ...r[id], ...patch }}));
      const pick = (sid,e) =>
        Array.from(e.target.files).forEach(f => {
          const r = new FileReader();
          r.onload = () => setImgs(m => ({ ...m, [sid]: [...(m[sid]||[]), r.result] }));
          r.readAsDataURL(f);
        });

      const score = () => {
        let t=0,m=0;
        CHECKLIST.sections.forEach(s => s.items.forEach(i => {
          const v = resp[i.id];
          if(!v.na && v.score!=null){ t+=v.score; m+=i.w; }
        }));
        return `${t}/${m} (${m?Math.round(100*t/m):0}%)`;
      };

      const submit = e => {
        e.preventDefault();
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text(`Score: ${score()}`, 14, 14);
        doc.text(`Report | ${storeName}`, 14, 22);
        let y = 30;
        CHECKLIST.sections.forEach(sec => {
          doc.setFontSize(12);
          doc.text(sec.title, 14, y); y += 6;
          const rows = sec.items.map(i => {
            const v = resp[i.id];
            return [i.q, v.na?'NA':(v.score===i.w?'Yes':'No')];
          });
          doc.autoTable({
            startY: y,
            head: [['Question','Response']],
            body: rows,
            styles: { fontSize: 8 },
            headStyles: { fillColor: [229,229,229] },
            didParseCell: d => {
              if(d.section==='body'&&d.column.index===1){
                const t = d.cell.text[0];
                d.cell.styles.textColor = t==='Yes'? [0,128,0]: t==='No'? [255,0,0]: [255,165,0];
              }
            }
          });
          y = doc.autoTable.previous.finalY + 6;
          (imgs[sec.id]||[]).forEach(src => { doc.addImage(src,'JPEG',14,y,30,20); y += 22; });
        });
        doc.save(`audit_${auditor.id}_${Date.now()}.pdf`);
      };

      return (
        React.createElement('form',{onSubmit:submit},
          React.createElement('h1',{className:'title'},'Third Wave Coffee | Training Audit'),
          React.createElement('div',{className:'info-box'},
            React.createElement('input',{type:'text',placeholder:'Auditor Name',value:auditor.name,readOnly:true,className:'w-full mb-2'}),
            React.createElement('input',{type:'text',placeholder:'Auditor ID',value:auditor.id,readOnly:true,className:'w-full mb-2'}),
            React.createElement('input',{type:'text',placeholder:'Store Name',value:storeName,onChange:e=>setStoreName(e.target.value),required:true,className:'w-full mb-2'}),
            React.createElement('input',{type:'text',placeholder:'Store ID',value:storeId,onChange:e=>setStoreId(e.target.value),required:true,className:'w-full'})
          ),
          CHECKLIST.sections.map(sec =>
            React.createElement('div',{key:sec.id,className:'section'},
              React.createElement('h2',null,sec.title),
              React.createElement('table',null,
                React.createElement('thead',null,
                  React.createElement('tr',null,
                    React.createElement('th',null,'Question'),
                    React.createElement('th',null,'Yes'),
                    React.createElement('th',null,'No'),
                    React.createElement('th',null,'NA')
                  )
                ),
                React.createElement('tbody',null,
                  sec.items.map(i => {
                    const v = resp[i.id];
                    return React.createElement('tr',{key:i.id},
                      React.createElement('td',{className:'text-xs'},i.q),
                      ['Yes','No','NA'].map(lbl =>
                        React.createElement('td',{key:lbl,className:'text-center'},
                          React.createElement('input',{
                            type:'radio',
                            name:i.id,
                            value:lbl.toLowerCase(),
                            required:true,
                            checked: lbl==='NA'?v.na : lbl==='Yes'?v.score===i.w : v.score===0&&!v.na,
                            onChange:()=>upd(i.id, lbl==='NA'?{na:true,score:null}: lbl==='Yes'?{score:i.w,na:false}:{score:0,na:false})
                          })
                        )
                      )
                    );
                  })
                )
              ),
              React.createElement('input',{type:'file',accept:'image/*',capture:'environment',multiple:true,onChange:e=>pick(sec.id,e),className:'mb-2'}),
              React.createElement('div',null,(imgs[sec.id]||[]).map((src,i)=>React.createElement('img',{key:i,src:src,className:'photo-preview'})))
            )
          ),
          React.createElement('button',{type:'submit',className:'btn'},'Download PDF')
        )
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
  </script>
</body>
</html>"}]}
